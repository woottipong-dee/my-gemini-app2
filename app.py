import streamlit as st
import google.generativeai as genai
import pandas as pd
from datetime import datetime, timedelta

# --- 1. CONFIG & THEME ---
st.set_page_config(page_title="PEA MAERIM Fleet Flow", layout="wide")

# ‡∏™‡∏µ‡∏õ‡∏£‡∏∞‡∏à‡∏≥ ‡∏Å‡∏ü‡∏†.
PURPLE = "#542173"
GOLD = "#FFB800"

st.markdown(f"""
    <style>
    .main {{ background-color: #f5f5f5; }}
    .stButton>button {{ background-color: {PURPLE}; color: white; border-radius: 20px; }}
    .stSidebar {{ background-color: white; border-right: 2px solid {PURPLE}; }}
    .card {{ background: white; padding: 20px; border-radius: 15px; box-shadow: 2px 2px 10px rgba(0,0,0,0.1); border-top: 5px solid {GOLD}; }}
    </style>
    """, unsafe_allow_html=True)

# --- 2. AI SETUP ---
if "GEMINI_API_KEY" in st.secrets:
    genai.configure(api_key=st.secrets["GEMINI_API_KEY"])
    model = genai.GenerativeModel('gemini-1.5-flash')

# --- 3. SIDEBAR MENU ---
with st.sidebar:
    st.image("https://upload.wikimedia.org/wikipedia/th/thumb/a/a2/PEA_Logo.svg/1200px-PEA_Logo.svg.png", width=100)
    st.title("PEA MAERIM")
    menu = st.radio("‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å", ["üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å", "üìÖ ‡∏à‡∏≠‡∏á‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå", "üîç ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ", "üîÑ ‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ", "üõ†Ô∏è ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ & AI"])

# --- 4. APP LOGIC ---

# ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
if menu == "üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å":
    st.markdown(f"### <span style='color:{PURPLE}'>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞ ‡∏Å‡∏ü‡∏†.‡πÅ‡∏°‡πà‡∏£‡∏¥‡∏°</span>", unsafe_allow_html=True)
    
    col1, col2, col3 = st.columns(3)
    with col1:
        st.markdown(f"<div class='card'><b>üöó ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</b><h2>8 ‡∏Ñ‡∏±‡∏ô</h2></div>", unsafe_allow_html=True)
    with col2:
        st.markdown(f"<div class='card'><b>‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</b><h2>5 ‡∏Ñ‡∏±‡∏ô</h2></div>", unsafe_allow_html=True)
    with col3:
        st.markdown(f"<div class='card'><b>‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏†‡∏≤‡∏©‡∏µ</b><h2>2 ‡∏Ñ‡∏±‡∏ô</h2></div>", unsafe_allow_html=True)

    st.subheader("üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå‡∏£‡∏≤‡∏¢‡∏Ñ‡∏±‡∏ô")
    # ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Card ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå
    st.info("üöó ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô ‡∏Å‡∏Ç-1234 (‡∏£‡∏ñ‡∏ï‡∏π‡πâ) - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ß‡πà‡∏≤‡∏á | ‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: 3 ‡∏õ‡∏µ 2 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô")

# ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏á‡∏£‡∏ñ
elif menu == "üìÖ ‡∏à‡∏≠‡∏á‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå":
    st.subheader("‡πÉ‡∏ö‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå")
    with st.container():
        name = st.text_input("‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á")
        emp_id = st.text_input("‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô")
        car = st.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏ñ", ["‡∏Å‡∏Ç-1234 (‡∏£‡∏ñ‡∏ï‡∏π‡πâ)", "‡∏°‡∏Ñ-5566 (‡∏£‡∏ñ‡∏Å‡∏£‡∏∞‡∏ö‡∏∞)"])
        start_date = st.date_input("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ")
        
        if st.button("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≠‡∏á (‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)"):
            if name and emp_id:
                st.success("‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥")
            else:
                st.error("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô")

# ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏ñ
elif menu == "üîç ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ":
    st.subheader("‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏†‡∏≤‡∏û‡∏£‡∏ñ")
    st.file_uploader("üì∏ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏†‡∏≤‡∏û‡∏£‡∏ñ", type=['jpg','png'])
    q1 = st.checkbox("‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥")
    q2 = st.checkbox("‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ö‡∏£‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥")
    q3 = st.checkbox("‡∏•‡∏°‡∏¢‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô")
    
    if st.button("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö"):
        st.success("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏ñ‡πÑ‡∏î‡πâ")

# ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ
elif menu == "üîÑ ‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ":
    st.subheader("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå")
    fuel = st.slider("‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (%)", 0, 100, 100)
    mileage = st.number_input("‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ", min_value=0)
    note = st.text_area("‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)")
    
    if st.button("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ"):
        st.balloons()
        st.success("‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏ñ‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß")

# ‡∏´‡∏ô‡πâ‡∏≤ AI
elif menu == "üõ†Ô∏è ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ & AI":
    st.subheader("‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏î‡πâ‡∏ß‡∏¢ AI")
    if st.button("ü§ñ ‡πÉ‡∏´‡πâ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ú‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á"):
        with st.spinner("AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•..."):
            # ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Gemini
            res = model.generate_content("‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏ñ‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡∏•‡πå 120,000 ‡∏Å‡∏°. ‡∏Ñ‡∏ß‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ?")
            st.write(res.text)
